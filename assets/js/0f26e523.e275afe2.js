"use strict";(self.webpackChunktracetest_docs=self.webpackChunktracetest_docs||[]).push([[2633],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>m});var a=n(67294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,s=function(e,t){if(null==e)return{};var n,a,s={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var c=a.createContext({}),o=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},l=function(e){var t=o(e.components);return a.createElement(c.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,s=e.mdxType,i=e.originalType,c=e.parentName,l=p(e,["components","mdxType","originalType","parentName"]),d=o(n),h=s,m=d["".concat(c,".").concat(h)]||d[h]||u[h]||i;return n?a.createElement(m,r(r({ref:t},l),{},{components:n})):a.createElement(m,r({ref:t},l))}));function m(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var i=n.length,r=new Array(i);r[0]=h;var p={};for(var c in t)hasOwnProperty.call(t,c)&&(p[c]=t[c]);p.originalType=e,p[d]="string"==typeof e?e:s,r[1]=p;for(var o=2;o<i;o++)r[o]=n[o];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},85497:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>p,toc:()=>o});var a=n(87462),s=(n(67294),n(3905));const i={},r="Selectors",p={unversionedId:"concepts/selectors",id:"concepts/selectors",title:"Selectors",description:"If you find yourself in a position where you cannot select complex spans, you can use our advanced selectors to help with that task. Advanced selectors enable selecting spans that are impossible to select using just basic selectors.",source:"@site/docs/concepts/selectors.md",sourceDirName:"concepts",slug:"/concepts/selectors",permalink:"/concepts/selectors",draft:!1,editUrl:"https://github.com/kubeshop/tracetest/blob/main/docs/docs/concepts/selectors.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Variable Sets",permalink:"/concepts/variable-sets"},next:{title:"Expressions",permalink:"/concepts/expressions"}},c={},o=[{value:"<strong>Features</strong>",id:"features",level:2},{value:"<strong>Empty Selector</strong>",id:"empty-selector",level:3},{value:"<strong>Filter by Attributes</strong>",id:"filter-by-attributes",level:3},{value:"<strong>AND Condition</strong>",id:"and-condition",level:4},{value:"<strong>OR Condition</strong>",id:"or-condition",level:4},{value:"<strong>Contains Operator</strong>",id:"contains-operator",level:4},{value:"<strong>Pseudo-classes Support</strong>",id:"pseudo-classes-support",level:3},{value:"<strong>:first</strong>",id:"first",level:4},{value:"<strong>:last</strong>",id:"last",level:4},{value:"<strong>:nth_child</strong>",id:"nth_child",level:4},{value:"<strong>Parent-child Relation Filtering</strong>",id:"parent-child-relation-filtering",level:3}],l={toc:o},d="wrapper";function u(e){let{components:t,...n}=e;return(0,s.kt)(d,(0,a.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"selectors"},"Selectors"),(0,s.kt)("p",null,"If you find yourself in a position where you cannot select complex spans, you can use our advanced selectors to help with that task. Advanced selectors enable selecting spans that are impossible to select using just basic selectors."),(0,s.kt)("p",null,"In order to present each selector feature as easily as possible, we will use a theoretical scenario of an e-commerce application."),(0,s.kt)("p",null,"The system that we will inspect has this flow:"),(0,s.kt)("mermaid",{value:"flowchart LR\n    start((start))\n    subgraph purchase\n        cart-api\n        purchase-api\n    end\n    subgraph auth\n        auth-api\n        auth-storage[(db)]\n    end\n    subgraph product\n        product-api\n        product-storage[(db)]\n    end\n    subgraph notification\n        notification-api\n        kafka{{kafka}}\n        external-notification-service{{external service}}\n    end\n\n    start --\x3e|1. Close order| cart-api\n    cart-api--\x3e|5. send buy action| purchase-api\n    purchase-api --\x3e |7. Send notification to user|notification-api\n    purchase-api --\x3e|6. can product be bought by user?| auth-api\n    auth-api --\x3e auth-storage\n    cart-api --\x3e|2. is product available?| product-api\n    product-api --\x3e|4. can user view product?| auth-api\n    product-api --\x3e|3. retrieve product| product-storage\n\n    notification-api --\x3e|8| kafka\n    kafka --\x3e|9| external-notification-service"}),(0,s.kt)("p",null,"And it generates the following trace:"),(0,s.kt)("mermaid",{value:'flowchart TD\n    A[" id: 1\n        close order\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    B[" id: 2\n        is product available\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    C[" id: 3\n        get product information\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    D[" id: 4\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    E[" id: 5\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    F[" id: 6\n        purchase products\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    G[" id: 7\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    H[" id: 8\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    I[" id: 9\n        notify user\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    J[" id: 10\n        send message to kafka\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: messaging\n    "]\n    K[" id: 10\n        send message to users\n\n        attributes:\n        service.name: external-service\n        tracetest.span.type: messaging\n    "]\n\n\n    A --\x3e|1| B\n    B --\x3e|2| C\n    B --\x3e|3| D\n    D --\x3e|4| E\n    A --\x3e|5| F\n    F --\x3e|6| G\n    G --\x3e|7| H\n    F --\x3e|8| I\n    I --\x3e|9| J\n    J --\x3e|10| K'}),(0,s.kt)("h2",{id:"features"},(0,s.kt)("strong",{parentName:"h2"},"Features")),(0,s.kt)("h3",{id:"empty-selector"},(0,s.kt)("strong",{parentName:"h3"},"Empty Selector")),(0,s.kt)("p",null,"By providing an empty selector, all spans from the trace are selected. Note that an empty selector is an empty string. Providing ",(0,s.kt)("inlineCode",{parentName:"p"},"span")," or ",(0,s.kt)("inlineCode",{parentName:"p"},"span[]")," as a selector will result as a syntax error."),(0,s.kt)("h3",{id:"filter-by-attributes"},(0,s.kt)("strong",{parentName:"h3"},"Filter by Attributes")),(0,s.kt)("p",null,"The most basic way of filtering the spans to apply an assertion to is to use the span's attributes. A good starting example would be filtering all spans of type ",(0,s.kt)("inlineCode",{parentName:"p"},"http"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-css"},'span[tracetest.span.type="http"]\n')),(0,s.kt)("p",null,"This would select the following spans:"),(0,s.kt)("mermaid",{value:'flowchart TD\n    A[" id: 1\n        close order\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    B[" id: 2\n        is product available\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    C[" id: 3\n        get product information\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    D[" id: 4\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    E[" id: 5\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    F[" id: 6\n        purchase products\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    G[" id: 7\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    H[" id: 8\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    I[" id: 9\n        notify user\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    J[" id: 10\n        send message to kafka\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: messaging\n    "]\n    K[" id: 10\n        send message to users\n\n        attributes:\n        service.name: external-service\n        tracetest.span.type: messaging\n    "]\n\n\n    A --\x3e|1| B\n    B --\x3e|2| C\n    B --\x3e|3| D\n    D --\x3e|4| E\n    A --\x3e|5| F\n    F --\x3e|6| G\n    G --\x3e|7| H\n    F --\x3e|8| I\n    I --\x3e|9| J\n    J --\x3e|10| K\n\n    classDef selectedSpan fill:#439846, color:#ffffff\n    classDef candidateSpan fill:#FF6905, color:#ffffff\n\n    class A selectedSpan\n    class B selectedSpan\n    class D selectedSpan\n    class F selectedSpan\n    class G selectedSpan\n    class I selectedSpan'}),(0,s.kt)("h4",{id:"and-condition"},(0,s.kt)("strong",{parentName:"h4"},"AND Condition")),(0,s.kt)("p",null,"If you need to narrow down your results, you can provide multiple properties in the selector by separating them using a space. The following will select all ",(0,s.kt)("inlineCode",{parentName:"p"},"http")," spans ",(0,s.kt)("strong",{parentName:"p"},"AND")," spans that were created by the service ",(0,s.kt)("inlineCode",{parentName:"p"},"cart-api"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-css"},'span[tracetest.span.type="http" service.name="cart-api"]\n')),(0,s.kt)("p",null,"This would select the following spans:"),(0,s.kt)("mermaid",{value:'flowchart TD\n    A[" id: 1\n        close order\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    B[" id: 2\n        is product available\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    C[" id: 3\n        get product information\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    D[" id: 4\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    E[" id: 5\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    F[" id: 6\n        purchase products\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    G[" id: 7\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    H[" id: 8\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    I[" id: 9\n        notify user\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    J[" id: 10\n        send message to kafka\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: messaging\n    "]\n    K[" id: 10\n        send message to users\n\n        attributes:\n        service.name: external-service\n        tracetest.span.type: messaging\n    "]\n\n\n    A --\x3e|1| B\n    B --\x3e|2| C\n    B --\x3e|3| D\n    D --\x3e|4| E\n    A --\x3e|5| F\n    F --\x3e|6| G\n    G --\x3e|7| H\n    F --\x3e|8| I\n    I --\x3e|9| J\n    J --\x3e|10| K\n\n    classDef selectedSpan fill:#439846, color:#ffffff\n    classDef candidateSpan fill:#FF6905, color:#ffffff\n\n    class A selectedSpan\n    class F selectedSpan'}),(0,s.kt)("h4",{id:"or-condition"},(0,s.kt)("strong",{parentName:"h4"},"OR Condition")),(0,s.kt)("p",null,"Sometimes we want to have a broader result by selecting spans that match different selectors. Let's say we have to get all spans from our services, but not from any other external service."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-css"},'span[service.name="api-product"], span[service.name="api-auth"], span[service.name="api-notification"], span[service.name="api-cart"]\n')),(0,s.kt)("p",null,"This would select the following spans:"),(0,s.kt)("mermaid",{value:'flowchart TD\n    A[" id: 1\n        close order\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    B[" id: 2\n        is product available\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    C[" id: 3\n        get product information\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    D[" id: 4\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    E[" id: 5\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    F[" id: 6\n        purchase products\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    G[" id: 7\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    H[" id: 8\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    I[" id: 9\n        notify user\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    J[" id: 10\n        send message to kafka\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: messaging\n    "]\n    K[" id: 10\n        send message to users\n\n        attributes:\n        service.name: external-service\n        tracetest.span.type: messaging\n    "]\n\n\n    A --\x3e|1| B\n    B --\x3e|2| C\n    B --\x3e|3| D\n    D --\x3e|4| E\n    A --\x3e|5| F\n    F --\x3e|6| G\n    G --\x3e|7| H\n    F --\x3e|8| I\n    I --\x3e|9| J\n    J --\x3e|10| K\n\n    classDef selectedSpan fill:#439846, color:#ffffff\n    classDef candidateSpan fill:#FF6905, color:#ffffff\n\n    class A selectedSpan\n    class B selectedSpan\n    class C selectedSpan\n    class D selectedSpan\n    class E selectedSpan\n    class F selectedSpan\n    class G selectedSpan\n    class H selectedSpan\n    class I selectedSpan\n    class J selectedSpan'}),(0,s.kt)("p",null,"Each span selector will be executed individually and the results will be merged together, creating a list of all spans that match any of the provided span selectors."),(0,s.kt)("h4",{id:"contains-operator"},(0,s.kt)("strong",{parentName:"h4"},"Contains Operator")),(0,s.kt)("p",null,"Although it is possible to filter several span selectors at once to get a broader result, it might become verbose very quickly. The previous example can be written in another way to reduce its complexity:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-css"},'span[service.name contains "api"]\n')),(0,s.kt)("p",null,"This would select the same spans as the previous example:"),(0,s.kt)("mermaid",{value:'flowchart TD\n    A[" id: 1\n        close order\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    B[" id: 2\n        is product available\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    C[" id: 3\n        get product information\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    D[" id: 4\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    E[" id: 5\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    F[" id: 6\n        purchase products\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    G[" id: 7\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    H[" id: 8\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    I[" id: 9\n        notify user\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    J[" id: 10\n        send message to kafka\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: messaging\n    "]\n    K[" id: 10\n        send message to users\n\n        attributes:\n        service.name: external-service\n        tracetest.span.type: messaging\n    "]\n\n\n    A --\x3e|1| B\n    B --\x3e|2| C\n    B --\x3e|3| D\n    D --\x3e|4| E\n    A --\x3e|5| F\n    F --\x3e|6| G\n    G --\x3e|7| H\n    F --\x3e|8| I\n    I --\x3e|9| J\n    J --\x3e|10| K\n\n    classDef selectedSpan fill:#439846, color:#ffffff\n    classDef candidateSpan fill:#FF6905, color:#ffffff\n\n    class A selectedSpan\n    class B selectedSpan\n    class C selectedSpan\n    class D selectedSpan\n    class E selectedSpan\n    class F selectedSpan\n    class G selectedSpan\n    class H selectedSpan\n    class I selectedSpan\n    class J selectedSpan'}),(0,s.kt)("h3",{id:"pseudo-classes-support"},(0,s.kt)("strong",{parentName:"h3"},"Pseudo-classes Support")),(0,s.kt)("p",null,"Sometimes filtering by attributes is not enough because we might have two or three identical spans in the tree but we only want to assert one of them. For example, imagine a system that has a ",(0,s.kt)("inlineCode",{parentName:"p"},"retry")," policy for all the HTTP requests it sends. How would we allow a user to validate if the ",(0,s.kt)("inlineCode",{parentName:"p"},"third")," execution was successful without asserting the other two spans?"),(0,s.kt)("p",null,"This is where pseudo-classes enter the scene. Pseudo-classes are ways of filtering spans by data that is not present in the span itself. For example, the order which the span appears."),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("strong",{parentName:"p"},"Note"),": Today we support only ",(0,s.kt)("inlineCode",{parentName:"p"},"first"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"last"),", and ",(0,s.kt)("inlineCode",{parentName:"p"},"nth_child"),". If you think we should implement others, please open an issue and explain why it is important and how it should behave.")),(0,s.kt)("p",null,"For the examples of the three pseudo-classes, let's consider that we want to select a specific ",(0,s.kt)("inlineCode",{parentName:"p"},"http")," span based on when it happens."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-css"},'span[tracetest.span.type="http"]\n')),(0,s.kt)("p",null,"This will select the following spans:"),(0,s.kt)("mermaid",{value:'flowchart TD\n    A[" id: 1\n        close order\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    B[" id: 2\n        is product available\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    C[" id: 3\n        get product information\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    D[" id: 4\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    E[" id: 5\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    F[" id: 6\n        purchase products\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    G[" id: 7\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    H[" id: 8\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    I[" id: 9\n        notify user\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    J[" id: 10\n        send message to kafka\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: messaging\n    "]\n    K[" id: 10\n        send message to users\n\n        attributes:\n        service.name: external-service\n        tracetest.span.type: messaging\n    "]\n\n\n    A --\x3e|1| B\n    B --\x3e|2| C\n    B --\x3e|3| D\n    D --\x3e|4| E\n    A --\x3e|5| F\n    F --\x3e|6| G\n    G --\x3e|7| H\n    F --\x3e|8| I\n    I --\x3e|9| J\n    J --\x3e|10| K\n\n    classDef selectedSpan fill:#439846, color:#ffffff\n    classDef candidateSpan fill:#FF6905, color:#ffffff\n\n    class A selectedSpan\n    class B selectedSpan\n    class D selectedSpan\n    class F selectedSpan\n    class G selectedSpan\n    class I selectedSpan'}),(0,s.kt)("h4",{id:"first"},(0,s.kt)("strong",{parentName:"h4"},":first")),(0,s.kt)("p",null,"This would return the first appearing span from the list:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-css"},'span[tracetest.span.type="http"]:first\n')),(0,s.kt)("mermaid",{value:'flowchart TD\n    A[" id: 1\n        close order\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    B[" id: 2\n        is product available\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    C[" id: 3\n        get product information\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    D[" id: 4\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    E[" id: 5\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    F[" id: 6\n        purchase products\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    G[" id: 7\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    H[" id: 8\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    I[" id: 9\n        notify user\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    J[" id: 10\n        send message to kafka\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: messaging\n    "]\n    K[" id: 10\n        send message to users\n\n        attributes:\n        service.name: external-service\n        tracetest.span.type: messaging\n    "]\n\n\n    A --\x3e|1| B\n    B --\x3e|2| C\n    B --\x3e|3| D\n    D --\x3e|4| E\n    A --\x3e|5| F\n    F --\x3e|6| G\n    G --\x3e|7| H\n    F --\x3e|8| I\n    I --\x3e|9| J\n    J --\x3e|10| K\n\n    classDef selectedSpan fill:#439846, color:#ffffff\n    classDef candidateSpan fill:#FF6905, color:#ffffff\n\n    class A selectedSpan\n    class B candidateSpan\n    class D candidateSpan\n    class F candidateSpan\n    class G candidateSpan\n    class I candidateSpan'}),(0,s.kt)("h4",{id:"last"},(0,s.kt)("strong",{parentName:"h4"},":last")),(0,s.kt)("p",null,"This would return the last appearing span from the list:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-css"},'span[tracetest.span.type="http"]:last\n')),(0,s.kt)("mermaid",{value:'flowchart TD\n    A[" id: 1\n        close order\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    B[" id: 2\n        is product available\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    C[" id: 3\n        get product information\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    D[" id: 4\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    E[" id: 5\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    F[" id: 6\n        purchase products\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    G[" id: 7\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    H[" id: 8\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    I[" id: 9\n        notify user\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    J[" id: 10\n        send message to kafka\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: messaging\n    "]\n    K[" id: 10\n        send message to users\n\n        attributes:\n        service.name: external-service\n        tracetest.span.type: messaging\n    "]\n\n\n    A --\x3e|1| B\n    B --\x3e|2| C\n    B --\x3e|3| D\n    D --\x3e|4| E\n    A --\x3e|5| F\n    F --\x3e|6| G\n    G --\x3e|7| H\n    F --\x3e|8| I\n    I --\x3e|9| J\n    J --\x3e|10| K\n\n    classDef selectedSpan fill:#439846, color:#ffffff\n    classDef candidateSpan fill:#FF6905, color:#ffffff\n\n    class A candidateSpan\n    class B candidateSpan\n    class D candidateSpan\n    class F candidateSpan\n    class G candidateSpan\n    class I selectedSpan'}),(0,s.kt)("h4",{id:"nth_child"},(0,s.kt)("strong",{parentName:"h4"},":nth_child")),(0,s.kt)("p",null,"This enables you to fetch any item from the list based on its index. ",(0,s.kt)("inlineCode",{parentName:"p"},"n")," starts at 1 (first element) and ends at ",(0,s.kt)("inlineCode",{parentName:"p"},"length")," (last element). Any invalid ",(0,s.kt)("inlineCode",{parentName:"p"},"n")," value will return in an empty list of spans being returned:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-css"},'span[tracetest.span.type="http"]:nth_child(3)\n')),(0,s.kt)("mermaid",{value:'flowchart TD\n    A[" id: 1\n        close order\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    B[" id: 2\n        is product available\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    C[" id: 3\n        get product information\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    D[" id: 4\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    E[" id: 5\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    F[" id: 6\n        purchase products\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    G[" id: 7\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    H[" id: 8\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    I[" id: 9\n        notify user\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    J[" id: 10\n        send message to kafka\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: messaging\n    "]\n    K[" id: 10\n        send message to users\n\n        attributes:\n        service.name: external-service\n        tracetest.span.type: messaging\n    "]\n\n\n    A --\x3e|1| B\n    B --\x3e|2| C\n    B --\x3e|3| D\n    D --\x3e|4| E\n    A --\x3e|5| F\n    F --\x3e|6| G\n    G --\x3e|7| H\n    F --\x3e|8| I\n    I --\x3e|9| J\n    J --\x3e|10| K\n\n    classDef selectedSpan fill:#439846, color:#ffffff\n    classDef candidateSpan fill:#FF6905, color:#ffffff\n\n    class A candidateSpan\n    class B candidateSpan\n    class D selectedSpan\n    class F candidateSpan\n    class G candidateSpan\n    class I candidateSpan'}),(0,s.kt)("h3",{id:"parent-child-relation-filtering"},(0,s.kt)("strong",{parentName:"h3"},"Parent-child Relation Filtering")),(0,s.kt)("p",null,"Even with all those capabilities, we might have problems with ambiguous selectors returning several spans when just a few were intended."),(0,s.kt)("p",null,"In our example, ",(0,s.kt)("inlineCode",{parentName:"p"},"auth-api")," is called twice from different parts of the trace. At first by ",(0,s.kt)("inlineCode",{parentName:"p"},"product-api")," and later by ",(0,s.kt)("inlineCode",{parentName:"p"},"cart-api"),"."),(0,s.kt)("p",null,"What if I want to test if a product only available in US can be bought in UK? The product can be seen by the user, but it cannot be bought if the user is outside the US. Certainly, I cannot apply the same assertions on all ",(0,s.kt)("inlineCode",{parentName:"p"},"auth-api")," spans, otherwise the test will not pass."),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"\u2139\ufe0f When you filter by the parent-child relationship, spans are matched recursively in all levels below the parent. This doesn't match only direct children of the parent, but all other spans in the sub-tree.")),(0,s.kt)("p",null,"For example:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-css"},'span[service.name="auth-api" tracetest.span.type="http"]\n')),(0,s.kt)("p",null,"Will return:"),(0,s.kt)("mermaid",{value:'flowchart TD\n    A[" id: 1\n        close order\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    B[" id: 2\n        is product available\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    C[" id: 3\n        get product information\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    D[" id: 4\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    E[" id: 5\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    F[" id: 6\n        purchase products\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    G[" id: 7\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    H[" id: 8\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    I[" id: 9\n        notify user\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    J[" id: 10\n        send message to kafka\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: messaging\n    "]\n    K[" id: 10\n        send message to users\n\n        attributes:\n        service.name: external-service\n        tracetest.span.type: messaging\n    "]\n\n\n    A --\x3e|1| B\n    B --\x3e|2| C\n    B --\x3e|3| D\n    D --\x3e|4| E\n    A --\x3e|5| F\n    F --\x3e|6| G\n    G --\x3e|7| H\n    F --\x3e|8| I\n    I --\x3e|9| J\n    J --\x3e|10| K\n\n    classDef selectedSpan fill:#439846, color:#ffffff\n    classDef candidateSpan fill:#FF6905, color:#ffffff\n\n    class D selectedSpan\n    class G selectedSpan'}),(0,s.kt)("p",null,"This is a problem, because if we apply the same assertion to both spans, one of them will fail. We could try to use ",(0,s.kt)("inlineCode",{parentName:"p"},"nth_child")," but that could break if a http request failed and the retry policy kicked in. Thus, the only way of filtering in this scenario is based on the context when it was generated. For example: using its parent span to do so."),(0,s.kt)("p",null,"We could use the ",(0,s.kt)("inlineCode",{parentName:"p"},"purchase products")," parent to ensure just ",(0,s.kt)("inlineCode",{parentName:"p"},"http")," class to the ",(0,s.kt)("inlineCode",{parentName:"p"},"auth-api")," triggered by the ",(0,s.kt)("inlineCode",{parentName:"p"},"purchase-api")," would be selected:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-css"},'span[service.name="cart-api", name="purchase products"] span[service.name="auth-api" tracetest.span.type="http"]\n')),(0,s.kt)("p",null,"This would find the parent span and only select the spans that are descedents of that parent and match the provided filter:"),(0,s.kt)("mermaid",{value:'flowchart TD\n    A[" id: 1\n        close order\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    B[" id: 2\n        is product available\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    C[" id: 3\n        get product information\n\n        attributes:\n        service.name: product-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    D[" id: 4\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    E[" id: 5\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    F[" id: 6\n        purchase products\n\n        attributes:\n        service.name: cart-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    G[" id: 7\n        get user can access\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: http\n        http.method: GET\n    "]\n    H[" id: 8\n        get user auth information\n\n        attributes:\n        service.name: auth-api\n        tracetest.span.type: db\n        db.statement: SELECT * FROM ...\n    "]\n    I[" id: 9\n        notify user\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: http\n        http.method: POST\n    "]\n    J[" id: 10\n        send message to kafka\n\n        attributes:\n        service.name: notification-api\n        tracetest.span.type: messaging\n    "]\n    K[" id: 10\n        send message to users\n\n        attributes:\n        service.name: external-service\n        tracetest.span.type: messaging\n    "]\n\n\n    A --\x3e|1| B\n    B --\x3e|2| C\n    B --\x3e|3| D\n    D --\x3e|4| E\n    A --\x3e|5| F\n    F --\x3e|6| G\n    G --\x3e|7| H\n    F --\x3e|8| I\n    I --\x3e|9| J\n    J --\x3e|10| K\n\n    classDef selectedSpan fill:#439846, color:#ffffff\n    classDef parentSpan fill:#3792cb, color:#ffffff\n\n    class F parentSpan\n    class G selectedSpan'}))}u.isMDXComponent=!0}}]);