"use strict";(self.webpackChunktracetest_docs=self.webpackChunktracetest_docs||[]).push([[6109],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>k});var s=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,s,a=function(e,t){if(null==e)return{};var n,s,a={},r=Object.keys(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=s.createContext({}),u=function(e){var t=s.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=u(e.components);return s.createElement(i.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},m=s.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),p=u(n),m=a,k=p["".concat(i,".").concat(m)]||p[m]||d[m]||r;return n?s.createElement(k,l(l({ref:t},c),{},{components:n})):s.createElement(k,l({ref:t},c))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,l=new Array(r);l[0]=m;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o[p]="string"==typeof e?e:a,l[1]=o;for(var u=2;u<r;u++)l[u]=n[u];return s.createElement.apply(null,l)}return s.createElement.apply(null,n)}m.displayName="MDXCreateElement"},15009:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>u});var s=n(87462),a=(n(67294),n(3905));const r={},l="Testkube Kubernetes-native Test Runner Pipeline",o={unversionedId:"ci-cd-automation/testkube-pipeline",id:"ci-cd-automation/testkube-pipeline",title:"Testkube Kubernetes-native Test Runner Pipeline",description:"Check out how the integration works, here.",source:"@site/docs/ci-cd-automation/testkube-pipeline.md",sourceDirName:"ci-cd-automation",slug:"/ci-cd-automation/testkube-pipeline",permalink:"/ci-cd-automation/testkube-pipeline",draft:!1,editUrl:"https://github.com/kubeshop/tracetest/blob/main/docs/docs/ci-cd-automation/testkube-pipeline.md",tags:[],version:"current",frontMatter:{},sidebar:"examplesTutorialsSidebar",previous:{title:"GitHub Actions Pipeline",permalink:"/ci-cd-automation/github-actions-pipeline"},next:{title:"Tekton Cloud-native Pipeline",permalink:"/ci-cd-automation/tekton-pipeline"}},i={},u=[{value:"Running Scheduled Trace-based Tests",id:"running-scheduled-trace-based-tests",level:2},{value:"Why do we want to run Tracetest with Testkube?",id:"why-do-we-want-to-run-tracetest-with-testkube",level:2},{value:"Infrastructure Overview",id:"infrastructure-overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Quickstart",id:"quickstart",level:2},{value:"1. Install Testkube CLI",id:"1-install-testkube-cli",level:2},{value:"2. Install Testkube in Your Kubernetes Cluster",id:"2-install-testkube-in-your-kubernetes-cluster",level:2},{value:"3. Install Tracetest CLI",id:"3-install-tracetest-cli",level:2},{value:"4. Install Tracetest in Your Kubernetes Cluster",id:"4-install-tracetest-in-your-kubernetes-cluster",level:2},{value:"5. Create a Test in Tracetest",id:"5-create-a-test-in-tracetest",level:2},{value:"6. Deploy the Tracetest Executor",id:"6-deploy-the-tracetest-executor",level:2},{value:"7. Create a Trace-based Test with Tracetest in Testkube",id:"7-create-a-trace-based-test-with-tracetest-in-testkube",level:2},{value:"8. Run the Tracetest Trace-based Test in Testkube",id:"8-run-the-tracetest-trace-based-test-in-testkube",level:2},{value:"9. Create a Trace-based Test That Runs Every Minute",id:"9-create-a-trace-based-test-that-runs-every-minute",level:2},{value:"Next Steps",id:"next-steps",level:2}],c={toc:u},p="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,s.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"testkube-kubernetes-native-test-runner-pipeline"},"Testkube Kubernetes-native Test Runner Pipeline"),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("a",{parentName:"p",href:"/tools-and-integrations/testkube"},"Check out how the integration works, here."))),(0,a.kt)("h2",{id:"running-scheduled-trace-based-tests"},"Running Scheduled Trace-based Tests"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/kubeshop/testkube-executor-tracetest"},"Testkube Tracetest Executor")," is a test executor to run Tracetest tests with Testkube."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"If you are using the latest version of Testkube, the Tracetest Executor will be bundled in Testkube by default. Read more in the Testkube docs, ",(0,a.kt)("a",{parentName:"p",href:"https://docs.testkube.io/test-types/executor-tracetest/"},"here"),"."),(0,a.kt)("p",{parentName:"admonition"},"Or, check out the hands-on workshop on YouTube!"),(0,a.kt)("iframe",{width:"100%",height:"250",src:"https://www.youtube.com/embed/nAp3zYgykok",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0})),(0,a.kt)("h2",{id:"why-do-we-want-to-run-tracetest-with-testkube"},"Why do we want to run Tracetest with Testkube?"),(0,a.kt)("p",null,"Tracetest leverages existing OpenTelemetry instrumentation to run assertions against every part of an HTTP transaction."),(0,a.kt)("p",null,"By integrating with Testkube you can now add Tracetest to the native CI/CD pipeline in your Kubernetes cluster. It allows you to run scheduled test runs and synthetic tests. All while following the trace-based testing principle and enabling full in-depth assertions against trace data, not just the response."),(0,a.kt)("h2",{id:"infrastructure-overview"},"Infrastructure Overview"),(0,a.kt)("p",null,"The following is high level sequence diagram on how Testkube and Tracetest interact with the different pieces of the system:"),(0,a.kt)("mermaid",{value:"sequenceDiagram\n    testkube client->>+testkube: Trigger Testkube test run\n    testkube->>+executor CRDs: Get executor details\n    executor CRDs--\x3e>-testkube: Send details\n    testkube->>+tracetest executor job: Schedules execution\n    tracetest executor job->>+tracetest executor job: Configure Tracetest CLI\n    tracetest executor job->>+tracetest server: Executes the Tracetest test run\n    tracetest server->>+instrumented service: Trigger request\n    instrumented service--\x3e>-tracetest server: Get response\n    instrumented service->>+data store: Send telemetry data\n    tracetest server->>+data store: Fetch trace\n    data store--\x3e>-tracetest server: Get trace\n    tracetest server->>+tracetest server: Run assertions\n    tracetest server--\x3e>-tracetest executor job: Return test run results\n    tracetest executor job--\x3e>-testkube: Return test run results\n    testkube--\x3e>-testkube client: Send details"}),(0,a.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("p",null,"Make sure you have these three things installed before starting."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"A running Kubernetes cluster (either locally or in the cloud)."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/"},"Kubectl")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://helm.sh/docs/intro/install/"},"Helm"))),(0,a.kt)("h2",{id:"quickstart"},"Quickstart"),(0,a.kt)("p",null,"Follow these steps to get started."),(0,a.kt)("h2",{id:"1-install-testkube-cli"},"1. Install Testkube CLI"),(0,a.kt)("p",null,"Install Testkube CLI by following ",(0,a.kt)("a",{parentName:"p",href:"https://docs.testkube.io/getting-started/step1-installing-cli"},"these instructions")," for your OS."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# MacOS example\nbrew install testkube\n")),(0,a.kt)("h2",{id:"2-install-testkube-in-your-kubernetes-cluster"},"2. Install Testkube in Your Kubernetes Cluster"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"testkube init\n")),(0,a.kt)("p",null,"Confirm that Testkube is running:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get all -n testkube\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="Expected output"',title:'"Expected','output"':!0},"NAME                                                        READY   STATUS    RESTARTS      AGE\npod/testkube-api-server-8f5cf8b8f-vrpk6                     1/1     Running   3 (14m ago)   18m\npod/testkube-dashboard-584846b754-4sxq8                     1/1     Running   0             18m\npod/testkube-minio-testkube-bd549c85d-lpwbm                 1/1     Running   0             18m\npod/testkube-mongodb-d78699775-cjcd7                        1/1     Running   0             18m\npod/testkube-nats-0                                         3/3     Running   0             18m\npod/testkube-nats-box-5b555bc9c4-5mpz5                      1/1     Running   0             18m\npod/testkube-operator-controller-manager-5f84bb4fd4-mjr2l   2/2     Running   0             18m\n\nNAME                                                           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                                                 AGE\nservice/testkube-api-server                                    ClusterIP   10.96.78.171    <none>        8088/TCP                                                18m\nservice/testkube-dashboard                                     ClusterIP   10.96.204.214   <none>        8080/TCP                                                18m\nservice/testkube-minio-service-testkube                        ClusterIP   10.96.85.219    <none>        9000/TCP,9090/TCP,9443/TCP                              18m\nservice/testkube-mongodb                                       ClusterIP   10.96.213.36    <none>        27017/TCP                                               18m\nservice/testkube-nats                                          ClusterIP   None            <none>        4222/TCP,6222/TCP,8222/TCP,7777/TCP,7422/TCP,7522/TCP   18m\nservice/testkube-operator-controller-manager-metrics-service   ClusterIP   10.96.243.219   <none>        8443/TCP                                                18m\nservice/testkube-operator-webhook-service                      ClusterIP   10.96.106.138   <none>        443/TCP                                                 18m\n\nNAME                                                   READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/testkube-api-server                    1/1     1            1           18m\ndeployment.apps/testkube-dashboard                     1/1     1            1           18m\ndeployment.apps/testkube-minio-testkube                1/1     1            1           18m\ndeployment.apps/testkube-mongodb                       1/1     1            1           18m\ndeployment.apps/testkube-nats-box                      1/1     1            1           18m\ndeployment.apps/testkube-operator-controller-manager   1/1     1            1           18m\n\nNAME                                                              DESIRED   CURRENT   READY   AGE\nreplicaset.apps/testkube-api-server-8f5cf8b8f                     1         1         1       18m\nreplicaset.apps/testkube-dashboard-584846b754                     1         1         1       18m\nreplicaset.apps/testkube-minio-testkube-bd549c85d                 1         1         1       18m\nreplicaset.apps/testkube-mongodb-d78699775                        1         1         1       18m\nreplicaset.apps/testkube-nats-box-5b555bc9c4                      1         1         1       18m\nreplicaset.apps/testkube-operator-controller-manager-5f84bb4fd4   1         1         1       18m\n\nNAME                             READY   AGE\nstatefulset.apps/testkube-nats   1/1     18m\n")),(0,a.kt)("p",null,"By default, Testkube is installed in the ",(0,a.kt)("inlineCode",{parentName:"p"},"testkube")," namespace."),(0,a.kt)("p",null,"To explore the Testkube dashboard, run the command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"testkube dashboard\n")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://res.cloudinary.com/djwdcmwdz/image/upload/v1679064043/Blogposts/Docs/screely-1679064032115_bnl4pc.png",alt:"Testkube Dashboard"})),(0,a.kt)("h2",{id:"3-install-tracetest-cli"},"3. Install Tracetest CLI"),(0,a.kt)("p",null,"Install Tracetest CLI by following ",(0,a.kt)("a",{parentName:"p",href:"https://docs.tracetest.io/getting-started/installation"},"these instructions")," for your OS."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# MacOS example\nbrew install kubeshop/tracetest/tracetest\n")),(0,a.kt)("h2",{id:"4-install-tracetest-in-your-kubernetes-cluster"},"4. Install Tracetest in Your Kubernetes Cluster"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"tracetest server install\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="Expected output"',title:'"Expected','output"':!0},"How do you want to run TraceTest? [type to search]:\n  Using Docker Compose\n> Using Kubernetes\n")),(0,a.kt)("p",null,"Select ",(0,a.kt)("inlineCode",{parentName:"p"},"Using Kubernetes"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="Expected output"',title:'"Expected','output"':!0},"Do you have OpenTelemetry based tracing already set up, or would you like us to install a demo tracing environment and app? [type to search]:\n  I have a tracing environment already. Just install Tracetest\n> Just learning tracing! Install Tracetest, OpenTelemetry Collector and the sample app.\n")),(0,a.kt)("p",null,"Select ",(0,a.kt)("inlineCode",{parentName:"p"},"Just learning tracing! Install Tracetest, OpenTelemetry Collector and the sample app."),"."),(0,a.kt)("p",null,"Confirm that Tracetest is running:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get all -n tracetest\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="Expected output"',title:'"Expected','output"':!0},"NAME                                  READY   STATUS    RESTARTS        AGE\npod/otel-collector-7f4d87489f-vp6zn   1/1     Running   0               5m41s\npod/tracetest-78b9c84c57-t4prx        1/1     Running   3 (4m15s ago)   5m29s\npod/tracetest-postgresql-0            1/1     Running   0               5m42s\n\nNAME                              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)               AGE\nservice/otel-collector            ClusterIP   10.96.173.226   <none>        4317/TCP              5m46s\nservice/tracetest                 ClusterIP   10.96.248.146   <none>        11633/TCP,4317/TCP   5m42s\nservice/tracetest-postgresql      ClusterIP   10.96.155.147   <none>        5432/TCP              5m42s\nservice/tracetest-postgresql-hl   ClusterIP   None            <none>        5432/TCP              5m42s\n\nNAME                             READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/otel-collector   1/1     1            1           5m46s\ndeployment.apps/tracetest        1/1     1            1           5m42s\n\nNAME                                        DESIRED   CURRENT   READY   AGE\nreplicaset.apps/otel-collector-7f4d87489f   1         1         1       5m46s\nreplicaset.apps/tracetest-78b9c84c57        1         1         1       5m42s\n\nNAME                                    READY   AGE\nstatefulset.apps/tracetest-postgresql   1/1     5m42s\n")),(0,a.kt)("p",null,"By default, Tracetest is installed in the ",(0,a.kt)("inlineCode",{parentName:"p"},"tracetest")," namespace."),(0,a.kt)("p",null,"To explore the Tracetest Web UI, run the command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl --kubeconfig <path-to-your-home>/.kube/config --context <your-cluster-context> --namespace tracetest port-forward svc/tracetest 11633\n")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://res.cloudinary.com/djwdcmwdz/image/upload/v1679064296/Blogposts/Docs/screely-1679064291876_jxlhmn.png",alt:"Tracetest Web UI"})),(0,a.kt)("h2",{id:"5-create-a-test-in-tracetest"},"5. Create a Test in Tracetest"),(0,a.kt)("p",null,"Start by clicking ",(0,a.kt)("inlineCode",{parentName:"p"},"Create")," > ",(0,a.kt)("inlineCode",{parentName:"p"},"Create New Test")," > ",(0,a.kt)("inlineCode",{parentName:"p"},"HTTP Request")," > ",(0,a.kt)("inlineCode",{parentName:"p"},"Next")," > ",(0,a.kt)("inlineCode",{parentName:"p"},"Choose Example")," (dropdown) > ",(0,a.kt)("inlineCode",{parentName:"p"},"Pokeshop - List")," (generates a sample test from the Tracetest demo) > ",(0,a.kt)("inlineCode",{parentName:"p"},"Next")," > ",(0,a.kt)("inlineCode",{parentName:"p"},"URL")," is prefilled with ",(0,a.kt)("inlineCode",{parentName:"p"},"http://demo-pokemon-api.demo/pokemon?take=20&skip=0")," > ",(0,a.kt)("inlineCode",{parentName:"p"},"Create & Run"),"."),(0,a.kt)("p",null,"This will trigger the test and display a distributed trace in the ",(0,a.kt)("inlineCode",{parentName:"p"},"Trace")," tab to run assertions against."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://res.cloudinary.com/djwdcmwdz/image/upload/v1679064990/Blogposts/Docs/screely-1679064984975_s0psbr.png",alt:"Tracetest distributed trace test run view"})),(0,a.kt)("p",null,"Proceed to add a test spec to assert all database queries return within 500 ms. Click the ",(0,a.kt)("inlineCode",{parentName:"p"},"Test")," tab and proceed to click the ",(0,a.kt)("inlineCode",{parentName:"p"},"Add Test Spec")," button."),(0,a.kt)("p",null,"In the span selector make sure to add this selector:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-css"},'span[tracetest.span.type="database"]\n')),(0,a.kt)("p",null,"In the assertion field add:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-css"},"attr:tracetest.span.duration < 500ms\n")),(0,a.kt)("p",null,"Save the test spec and publish the test."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://res.cloudinary.com/djwdcmwdz/image/upload/v1679071121/Blogposts/Docs/screely-1679071115690_hqhzh2.png",alt:"Assertion for database queries"})),(0,a.kt)("p",null,"The database spans that are returning in more than 500ms are labeled in red."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://res.cloudinary.com/djwdcmwdz/image/upload/v1679071183/Blogposts/Docs/screely-1679071177655_cjqwlk.png",alt:"Assertions failing"})),(0,a.kt)("p",null,"This is an example of a trace-based test that asserts against every single part of an HTTP transaction, including all interactions with the database."),(0,a.kt)("p",null,"However, Tracetest cannot run this test as part of your CI/CD without integrating with another tool."),(0,a.kt)("p",null,"Let's introduce how Testkube makes it possible."),(0,a.kt)("h2",{id:"6-deploy-the-tracetest-executor"},"6. Deploy the Tracetest Executor"),(0,a.kt)("p",null,"Testkube works with the concept of Executors. An Executor is a wrapper around a testing framework, Tracetest in this case, in the form of a Docker container and runs as a Kubernetes job. To start you need to register and deploy the Tracetest executor in your cluster using the Testkube CLI."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl testkube create executor --image kubeshop/testkube-executor-tracetest:latest --types "tracetest/test" --name tracetest-executor --icon-uri icon --content-type string --content-type file-uri\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="Expected output"',title:'"Expected','output"':!0},"Executor created tracetest-executor \ud83e\udd47\n")),(0,a.kt)("h2",{id:"7-create-a-trace-based-test-with-tracetest-in-testkube"},"7. Create a Trace-based Test with Tracetest in Testkube"),(0,a.kt)("p",null,"Click the \u2699\ufe0f button in the top right. Then click ",(0,a.kt)("inlineCode",{parentName:"p"},"Test Definition"),"."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://res.cloudinary.com/djwdcmwdz/image/upload/v1679065450/Blogposts/Docs/screely-1679065444972_zzsila.png",alt:"test settings"})),(0,a.kt)("p",null,"This will open a YAML definition for the test run."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://res.cloudinary.com/djwdcmwdz/image/upload/v1679071430/Blogposts/Docs/screely-1679071422136_ygbo8q.png",alt:"tracetest test yaml file"})),(0,a.kt)("p",null,"Save this into a file called ",(0,a.kt)("inlineCode",{parentName:"p"},"test.yaml"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'type: Test\nspec:\n  id: RUkKQ_aVR\n  name: Pokeshop - List\n  description: Get a Pokemon\n  trigger:\n    type: http\n    httpRequest:\n      url: http://demo-pokemon-api.demo/pokemon?take=20&skip=0\n      method: GET\n      headers:\n      - key: Content-Type\n        value: application/json\n  specs:\n  - name: Database queries less than 500 ms\n    selector: span[tracetest.span.type="database"]\n    assertions:\n    - attr:tracetest.span.duration  <  500ms\n')),(0,a.kt)("p",null,"Execute the following command to create the test executor object in Testkube. Do not forget to provide the path to your Tracetest definition file using the ",(0,a.kt)("inlineCode",{parentName:"p"},"--file")," argument and also the Tracetest Server endpoint using the ",(0,a.kt)("inlineCode",{parentName:"p"},"TRACETEST_ENDPOINT")," ",(0,a.kt)("inlineCode",{parentName:"p"},"--variable"),"."),(0,a.kt)("p",null,"Remember that your ",(0,a.kt)("inlineCode",{parentName:"p"},"TRACETEST_ENDPOINT")," should be reachable from Testkube in your cluster. Use your Tracetest service's ",(0,a.kt)("inlineCode",{parentName:"p"},"CLUSTER-IP:PORT"),". E.g: ",(0,a.kt)("inlineCode",{parentName:"p"},"10.96.93.106:11633"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl testkube create test --file ./test.yaml --type "tracetest/test" --name pokeshop-tracetest-test --variable TRACETEST_ENDPOINT=http://CLUSTER-IP:PORT\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="Expected output"',title:'"Expected','output"':!0},"Test created testkube / pokeshop-tracetest-test \ud83e\udd47\n")),(0,a.kt)("p",null,"Opening the Testkube Dashboard will show the test is created successfully."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://res.cloudinary.com/djwdcmwdz/image/upload/v1679071918/Blogposts/Docs/screely-1679071913649_yrgucd.png",alt:"Tracetest test created in Testkube"})),(0,a.kt)("h2",{id:"8-run-the-tracetest-trace-based-test-in-testkube"},"8. Run the Tracetest Trace-based Test in Testkube"),(0,a.kt)("p",null,"Finally, to run the test, execute the following command, or run the test from the Testkube Dashboard."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl testkube run test --watch pokeshop-tracetest-test\n")),(0,a.kt)("p",null,"Here's what the Testkube CLI will look like if the test fails."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="Expected output"',title:'"Expected','output"':!0},"Type:              tracetest/test\nName:              pokeshop-tracetest-test\nExecution ID:      641885f39922b3e1003dd5b6\nExecution name:    pokeshop-tracetest-test-3\nExecution number:  3\nStatus:            running\nStart time:        2023-03-20 16:12:35.268197087 +0000 UTC\nEnd time:          0001-01-01 00:00:00 +0000 UTC\nDuration:\n\n  Variables:    1\n  - TRACETEST_ENDPOINT = http://10.96.93.106:11633\n\nGetting logs from test job 641885f39922b3e1003dd5b6\nExecution completed\n\ud83d\udd2c Executing in directory :\n $ tracetest run test --server-url http://10.96.93.106:11633 --file /tmp/test-content737616681 --output pretty\n\u2718 Pokeshop - List (http://10.96.93.106:11633/test/RUkKQ_aVR/run/2/test)\n    \u2718 Database queries less than 500 ms\n        \u2718 #2b213392d0e3ff21\n            \u2718 attr:tracetest.span.duration  <  500ms (502ms) (http://10.96.93.106:11633/test/RUkKQ_aVR/run/2/test?selectedAssertion=0&selectedSpan=2b213392d0e3ff21)\n        \u2714 #7e6657f6a43fceeb\n            \u2714 attr:tracetest.span.duration  <  500ms (72ms)\n        \u2714 #6ee2fb69690eed47\n            \u2714 attr:tracetest.span.duration  <  500ms (13ms)\n        \u2718 #a82c304a3558763b\n            \u2718 attr:tracetest.span.duration  <  500ms (679ms) (http://10.96.93.106:11633/test/RUkKQ_aVR/run/2/test?selectedAssertion=0&selectedSpan=a82c304a3558763b)\n        \u2714 #6ae21f2251101fd6\n            \u2714 attr:tracetest.span.duration  <  500ms (393ms)\n        \u2714 #2a9b9422af8ba1a8\n            \u2714 attr:tracetest.span.duration  <  500ms (61ms)\n        \u2714 #010a8a0d53687276\n            \u2714 attr:tracetest.span.duration  <  500ms (36ms)\n        \u2718 #895d66286b6325ae\n            \u2718 attr:tracetest.span.duration  <  500ms (686ms) (http://10.96.93.106:11633/test/RUkKQ_aVR/run/2/test?selectedAssertion=0&selectedSpan=895d66286b6325ae)\n\n")),(0,a.kt)("p",null,"And, here's the Testkube Dashboard.\n",(0,a.kt)("img",{parentName:"p",src:"https://res.cloudinary.com/djwdcmwdz/image/upload/v1679328982/Blogposts/Docs/screely-1679328961663_nt3f2m.png",alt:"testkube failing tests"})),(0,a.kt)("p",null,"If the test passes, it'll look like this."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="Expected output"',title:'"Expected','output"':!0},"Type:              tracetest/test\nName:              pokeshop-tracetest-test\nExecution ID:      6418873d9922b3e1003dd5b8\nExecution name:    pokeshop-tracetest-test-4\nExecution number:  4\nStatus:            running\nStart time:        2023-03-20 16:18:05.60245717 +0000 UTC\nEnd time:          0001-01-01 00:00:00 +0000 UTC\nDuration:\n\n  Variables:    1\n  - TRACETEST_ENDPOINT = http://10.96.93.106:11633\n\n\nGetting logs from test job 6418873d9922b3e1003dd5b8\nExecution completed\n\ud83d\udd2c Executing in directory :\n $ tracetest run test --server-url http://10.96.93.106:11633 --file /tmp/test-content1901459587 --output pretty\n\u2714 Pokeshop - List (http://10.96.93.106:11633/test/RUkKQ_aVR/run/3/test)\n    \u2714 Database queries less than 500 ms\n\n\u2705 Execution succeeded\nExecution completed \u2714 Pokeshop - List (http://10.96.93.106:11633/test/RUkKQ_aVR/run/3/test)\n    \u2714 Database queries less than 500 ms\n")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://res.cloudinary.com/djwdcmwdz/image/upload/v1679329231/Blogposts/Docs/screely-1679329224534_qnqcl1.png",alt:"testkube passing tests"})),(0,a.kt)("h2",{id:"9-create-a-trace-based-test-that-runs-every-minute"},"9. Create a Trace-based Test That Runs Every Minute"),(0,a.kt)("p",null,"By using Testkube's ",(0,a.kt)("a",{parentName:"p",href:"https://docs.testkube.io/concepts/scheduling"},"scheduling"),", you can trigger this test every minute."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl testkube create test --file ./test.yaml --type "tracetest/test" --name pokeshop-tracetest-scheduled-test --schedule="*/1 * * * *" --variable TRACETEST_ENDPOINT=http://CLUSTER-IP:PORT\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="Expected output"',title:'"Expected','output"':!0},"Test created testkube / pokeshop-tracetest-scheduled-test \ud83e\udd47\n")),(0,a.kt)("p",null,"In your Testkube Dashboard you'll see this test run continuously and get triggered every minute."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://res.cloudinary.com/djwdcmwdz/image/upload/v1679330588/Blogposts/Docs/screely-1679330581788_izl5vs.png",alt:"scheduled test"})),(0,a.kt)("h2",{id:"next-steps"},"Next Steps"),(0,a.kt)("p",null,"To explore more options that Testkube gives you, check out ",(0,a.kt)("a",{parentName:"p",href:"https://docs.testkube.io/concepts/triggers"},"test triggers"),". They enable you to trigger tests based on Kubernetes events."))}d.isMDXComponent=!0}}]);